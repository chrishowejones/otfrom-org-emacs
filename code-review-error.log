
Thu Feb  2 15:42:07 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Thu Feb  2 15:42:27 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Thu Feb  2 15:44:32 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Thu Feb  2 15:45:45 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Thu Feb  2 15:49:02 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Thu Feb  2 16:06:55 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Thu Feb  2 17:08:15 2023 - code-review-github-errback - ((error http 422 ((message . "Unprocessable Entity") (errors "You need to leave a comment indicating the requested changes.") (documentation_url . "https://docs.github.com/rest/reference/pulls#create-a-review-for-a-pull-request"))) (("Server" . "GitHub.com") ("Date" . "Thu, 02 Feb 2023 17:08:15 GMT") ("Content-Type" . "application/json; charset=utf-8") ("Content-Length" . "211") ("X-OAuth-Scopes" . "read:org, repo, user") ("X-GitHub-Media-Type" . "github.v3; format=json") ("x-github-api-version-selected" . "2022-11-28") ("X-RateLimit-Limit" . "5000") ("X-RateLimit-Remaining" . "4985") ("X-RateLimit-Reset" . "1675359783") ("X-RateLimit-Used" . "15") ("X-RateLimit-Resource" . "core") ("Access-Control-Expose-Headers" . "ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, X-GitHub-SSO, X-GitHub-Request-Id, Deprecation, Sunset") ("Access-Control-Allow-Origin" . "*") ("Strict-Transport-Security" . "max-age=31536000; includeSubdomains; preload") ("X-Frame-Options" . "deny") ("X-Content-Type-Options" . "nosniff") ("X-XSS-Protection" . "0") ("Referrer-Policy" . "origin-when-cross-origin, strict-origin-when-cross-origin") ("Content-Security-Policy" . "default-src 'none'") ("Vary" . "Accept-Encoding, Accept, X-Requested-With") ("X-GitHub-Request-Id" . "DAB8:ACC7:33F3FB:34F27F:63DBEDFF")) (:error (error http 422 ((message . "Unprocessable Entity") (errors "You need to leave a comment indicating the requested changes.") (documentation_url . "https://docs.github.com/rest/reference/pulls#create-a-review-for-a-pull-request"))) :peer (:certificates ((:version 3 :serial-number "02:74:87:f4:82:d0:7c:b0:e8:41:cf:0a:29:35:7e:9b" :issuer "C=US,O=DigiCert Inc,CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1" :valid-from "2022-03-16" :valid-to "2023-03-16" :subject "C=US,ST=California,L=San Francisco,O=GitHub\\, Inc.,CN=*.github.com" :public-key-algorithm "EC/ECDSA" :certificate-security-level "High" :signature-algorithm "ECDSA-SHA384" :public-key-id "sha1:3c:44:2f:c0:73:92:af:34:6b:90:16:85:b8:7d:bf:3e:2c:89:d7:8c" :certificate-id "sha1:29:70:30:74:ca:3c:48:f5:4a:79:c6:2d:11:57:a2:41:2a:2d:7d:5c" :pem "-----BEGIN CERTIFICATE-----
MIIFZzCCBO6gAwIBAgIQAnSH9ILQfLDoQc8KKTV+mzAKBggqhkjOPQQDAzBWMQsw
CQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMTAwLgYDVQQDEydEaWdp
Q2VydCBUTFMgSHlicmlkIEVDQyBTSEEzODQgMjAyMCBDQTEwHhcNMjIwMzE2MDAw
MDAwWhcNMjMwMzE2MjM1OTU5WjBoMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2Fs
aWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZyYW5jaXNjbzEVMBMGA1UEChMMR2l0SHVi
LCBJbmMuMRUwEwYDVQQDDAwqLmdpdGh1Yi5jb20wWTATBgcqhkjOPQIBBggqhkjO
PQMBBwNCAARIb1gNoZrYHCt+5vNwBAU6Mx3vXDPyh+KkTCfkI3UYCvn93lPgXyQb
Ttqmy/y3l6afkW5+b+4xbWIle6D/3r9Bo4IDijCCA4YwHwYDVR0jBBgwFoAUCrwI
KReMpTlteg7OM8cus+37w3owHQYDVR0OBBYEFPxlb3xHAP8XtGvY1qhzy2K99THo
MCMGA1UdEQQcMBqCDCouZ2l0aHViLmNvbYIKZ2l0aHViLmNvbTAOBgNVHQ8BAf8E
BAMCB4AwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMIGbBgNVHR8EgZMw
gZAwRqBEoEKGQGh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5
YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5jcmwwRqBEoEKGQGh0dHA6Ly9jcmw0LmRp
Z2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5j
cmwwPgYDVR0gBDcwNTAzBgZngQwBAgIwKTAnBggrBgEFBQcCARYbaHR0cDovL3d3
dy5kaWdpY2VydC5jb20vQ1BTMIGFBggrBgEFBQcBAQR5MHcwJAYIKwYBBQUHMAGG
GGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBPBggrBgEFBQcwAoZDaHR0cDovL2Nh
Y2VydHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0VExTSHlicmlkRUNDU0hBMzg0MjAy
MENBMS0xLmNydDAJBgNVHRMEAjAAMIIBfQYKKwYBBAHWeQIEAgSCAW0EggFpAWcA
dQCt9776fP8QyIudPZwePhhqtGcpXc+xDCTKhYY069yCigAAAX+SOmyXAAAEAwBG
MEQCIACuiIEAOhMFn4ippfskCwgwcUCWfGTc+bwID8xLbueRAiBBLeHu31IreBwZ
l3ugr6/KfW9IqA8OQ7XgGlBUWErxxAB3ADXPGRu/sWxXvw+tTG1Cy7u2JyAmUeo/
4SrvqAPDO9ZMAAABf5I6bJcAAAQDAEgwRgIhAI/nbP4LpHcB1dlxle1FIblULpEZ
QkkEQLBT6ZOBNeaWAiEA7PsoTFPIJuD+Eo245DSCCfu0cZKmGwX8VZtHRBFPlX8A
dQCzc3cH4YRQ+GOG1gWp3BEJSnktsWcMC4fc8AMOeTalmgAAAX+SOmzEAAAEAwBG
MEQCIDqisYrdFm0laYJiZqZII6D2N9qmy1E42DvY178dZE92AiBGAE8xPDVm23lf
vQRCLO1PO5GxHsZq0tl/gjBS1dYzpDAKBggqhkjOPQQDAwNnADBkAjB4nbrDy4J4
BtaUrquwkgQtOboZ4UaO0kDlNbP/AvJ+NuJejyCQ/e3eV3cpGDJTHY8CMDNQXbqw
imW1ipqB2Zn9r8IVBqfkAaaBDSeb49ZHOtJqX0m+5wgG/LXCjhGCWJX9PQ==
-----END CERTIFICATE-----
") (:version 3 :serial-number "07:f2:f3:5c:87:a8:77:af:7a:ef:e9:47:99:35:25:bd" :issuer "C=US,O=DigiCert Inc,OU=www.digicert.com,CN=DigiCert Global Root CA" :valid-from "2021-04-14" :valid-to "2031-04-13" :subject "C=US,O=DigiCert Inc,CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1" :public-key-algorithm "EC/ECDSA" :certificate-security-level "Ultra" :signature-algorithm "RSA-SHA384" :public-key-id "sha1:3f:a4:c2:7e:9c:9c:89:2c:6b:98:6c:1c:3e:1f:40:20:49:d4:48:5f" :certificate-id "sha1:ae:c1:3c:dd:5e:a6:a3:99:8a:ec:14:ac:33:1a:d9:6b:ed:bb:77:0f" :pem "-----BEGIN CERTIFICATE-----
MIIEFzCCAv+gAwIBAgIQB/LzXIeod6967+lHmTUlvTANBgkqhkiG9w0BAQwFADBh
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD
QTAeFw0yMTA0MTQwMDAwMDBaFw0zMTA0MTMyMzU5NTlaMFYxCzAJBgNVBAYTAlVT
MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxMDAuBgNVBAMTJ0RpZ2lDZXJ0IFRMUyBI
eWJyaWQgRUNDIFNIQTM4NCAyMDIwIENBMTB2MBAGByqGSM49AgEGBSuBBAAiA2IA
BMEbxppbmNmkKaDp1AS12+umsmxVwP/tmMZJLwYnUcu/cMEFesOxnYeJuq20ExfJ
qLSDyLiQ0cx0NTY8g3KwtdD3ImnI8YDEe0CPz2iHJlw5ifFNkU3aiYvkA8ND5b8v
c6OCAYIwggF+MBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFAq8CCkXjKU5
bXoOzjPHLrPt+8N6MB8GA1UdIwQYMBaAFAPeUDVW0Uy7ZvCj4hsbw5eyPdFVMA4G
A1UdDwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwdgYI
KwYBBQUHAQEEajBoMCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5kaWdpY2VydC5j
b20wQAYIKwYBBQUHMAKGNGh0dHA6Ly9jYWNlcnRzLmRpZ2ljZXJ0LmNvbS9EaWdp
Q2VydEdsb2JhbFJvb3RDQS5jcnQwQgYDVR0fBDswOTA3oDWgM4YxaHR0cDovL2Ny
bDMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0R2xvYmFsUm9vdENBLmNybDA9BgNVHSAE
NjA0MAsGCWCGSAGG/WwCATAHBgVngQwBATAIBgZngQwBAgEwCAYGZ4EMAQICMAgG
BmeBDAECAzANBgkqhkiG9w0BAQwFAAOCAQEAR1mBf9QbH7Bx9phdGLqYR5iwfnYr
6v8ai6wms0KNMeZK6BnQ79oU59cUkqGS8qcuLa/7Hfb7U7CKP/zYFgrpsC62pQsY
kDUmotr2qLcy/JUjS8ZFucTP5Hzu5sn4kL1y45nDHQsFfGqXbbKrAjbYwrwsAZI/
BKOLdRHHuSm8EdCGupK8JvllyDfNJvaGEwwEqonleLHBTnm8dqMLUeTF0J5q/hos
Vq4GNiejcxwIfZMy0MJEGdqN9A57HSgDKwmKdsp33Id6rHtSJlWncg+d0ohP/rEh
xRqhqjn1VtvChMQ1H3Dau0bwhr9kAMQ+959GG50jBbl9s08PqUU643QwmA==
-----END CERTIFICATE-----
")) :certificate (:version 3 :serial-number "02:74:87:f4:82:d0:7c:b0:e8:41:cf:0a:29:35:7e:9b" :issuer "C=US,O=DigiCert Inc,CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1" :valid-from "2022-03-16" :valid-to "2023-03-16" :subject "C=US,ST=California,L=San Francisco,O=GitHub\\, Inc.,CN=*.github.com" :public-key-algorithm "EC/ECDSA" :certificate-security-level "High" :signature-algorithm "ECDSA-SHA384" :public-key-id "sha1:3c:44:2f:c0:73:92:af:34:6b:90:16:85:b8:7d:bf:3e:2c:89:d7:8c" :certificate-id "sha1:29:70:30:74:ca:3c:48:f5:4a:79:c6:2d:11:57:a2:41:2a:2d:7d:5c" :pem "-----BEGIN CERTIFICATE-----
MIIFZzCCBO6gAwIBAgIQAnSH9ILQfLDoQc8KKTV+mzAKBggqhkjOPQQDAzBWMQsw
CQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMTAwLgYDVQQDEydEaWdp
Q2VydCBUTFMgSHlicmlkIEVDQyBTSEEzODQgMjAyMCBDQTEwHhcNMjIwMzE2MDAw
MDAwWhcNMjMwMzE2MjM1OTU5WjBoMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2Fs
aWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZyYW5jaXNjbzEVMBMGA1UEChMMR2l0SHVi
LCBJbmMuMRUwEwYDVQQDDAwqLmdpdGh1Yi5jb20wWTATBgcqhkjOPQIBBggqhkjO
PQMBBwNCAARIb1gNoZrYHCt+5vNwBAU6Mx3vXDPyh+KkTCfkI3UYCvn93lPgXyQb
Ttqmy/y3l6afkW5+b+4xbWIle6D/3r9Bo4IDijCCA4YwHwYDVR0jBBgwFoAUCrwI
KReMpTlteg7OM8cus+37w3owHQYDVR0OBBYEFPxlb3xHAP8XtGvY1qhzy2K99THo
MCMGA1UdEQQcMBqCDCouZ2l0aHViLmNvbYIKZ2l0aHViLmNvbTAOBgNVHQ8BAf8E
BAMCB4AwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMIGbBgNVHR8EgZMw
gZAwRqBEoEKGQGh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5
YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5jcmwwRqBEoEKGQGh0dHA6Ly9jcmw0LmRp
Z2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5j
cmwwPgYDVR0gBDcwNTAzBgZngQwBAgIwKTAnBggrBgEFBQcCARYbaHR0cDovL3d3
dy5kaWdpY2VydC5jb20vQ1BTMIGFBggrBgEFBQcBAQR5MHcwJAYIKwYBBQUHMAGG
GGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBPBggrBgEFBQcwAoZDaHR0cDovL2Nh
Y2VydHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0VExTSHlicmlkRUNDU0hBMzg0MjAy
MENBMS0xLmNydDAJBgNVHRMEAjAAMIIBfQYKKwYBBAHWeQIEAgSCAW0EggFpAWcA
dQCt9776fP8QyIudPZwePhhqtGcpXc+xDCTKhYY069yCigAAAX+SOmyXAAAEAwBG
MEQCIACuiIEAOhMFn4ippfskCwgwcUCWfGTc+bwID8xLbueRAiBBLeHu31IreBwZ
l3ugr6/KfW9IqA8OQ7XgGlBUWErxxAB3ADXPGRu/sWxXvw+tTG1Cy7u2JyAmUeo/
4SrvqAPDO9ZMAAABf5I6bJcAAAQDAEgwRgIhAI/nbP4LpHcB1dlxle1FIblULpEZ
QkkEQLBT6ZOBNeaWAiEA7PsoTFPIJuD+Eo245DSCCfu0cZKmGwX8VZtHRBFPlX8A
dQCzc3cH4YRQ+GOG1gWp3BEJSnktsWcMC4fc8AMOeTalmgAAAX+SOmzEAAAEAwBG
MEQCIDqisYrdFm0laYJiZqZII6D2N9qmy1E42DvY178dZE92AiBGAE8xPDVm23lf
vQRCLO1PO5GxHsZq0tl/gjBS1dYzpDAKBggqhkjOPQQDAwNnADBkAjB4nbrDy4J4
BtaUrquwkgQtOboZ4UaO0kDlNbP/AvJ+NuJejyCQ/e3eV3cpGDJTHY8CMDNQXbqw
imW1ipqB2Zn9r8IVBqfkAaaBDSeb49ZHOtJqX0m+5wgG/LXCjhGCWJX9PQ==
-----END CERTIFICATE-----
") :key-exchange "ECDHE-RSA" :protocol "TLS1.3" :cipher "AES-128-GCM" :mac "AEAD" :encrypt-then-mac nil)) #s(ghub--req #s(url "https" nil nil "api.github.com" nil "/repos/cambioscience/obrizum/pulls/198/reviews" nil nil t nil t t) nil nil "POST" #[0 "\302\305=\203 \306\307\303\301\242\"B\304\242B\207\310\303\302\301\242\300$\304\242B\207" [nil ("chrishowejones") code-review "api.github.com" ((("Content-Type" . "application/json"))) basic "Authorization" ghub--basic-auth ghub--auth] 5] ghub--handle-response nil t nil #[128 "\303\304\300\305\303#\210\304\300\306\307 #\210\310\300!\210\311
\312\313#)\207" [#s(#s(eieio--class code-review-github-repo nil (#s(eieio--class code-review-db-pullreq nil (#s(eieio--class closql-object nil nil [#s(cl-slot-descriptor closql-database nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1)) (code-review-db-pullreq code-review-db-comment code-review-db-path code-review-db-buffer forge-object) ((:closql-database . closql-database)) [#s(cl-slot-descriptor closql-order-by nil t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key nil t nil) #s(cl-slot-descriptor closql-table nil t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix nil t nil)] [nil nil nil nil nil nil] #s(#9 nil) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer)))] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30)) (code-review-bitbucket-repo code-review-gitlab-repo code-review-github-repo) ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-class-prefix "code-review-" t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-order-by [(desc number)] t nil)] ["code-review-" nil pullreq id nil [(desc number)]] #s(#7 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer))) #s(cl-slot-descriptor callback nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30 callback 31)) nil ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-order-by [(desc number)] t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix "code-review-" t nil)] [[(desc number)] nil id pullreq nil "code-review-"] #s(#5 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound nil) (:custom-groups nil)) #s(code-review-db-database #<process emacsql-sqlite<1>> #<buffer  *emacsql-log*-597065> #<finalizer> "/home/chris/.emacs.d/code-review-db-file.sqlite") "42e265f8-82bb-47e8-be07-c73eb8d75156" "master" "OBR-960" t "Thu Feb  2 17:07:23 2023" nil nil ((id . "PR_kwDOFQcPnc5JGhqk") (author (login . "OBRFrancis") (url . "https://github.com/OBRFrancis")) (headRefOid . "4a5799fbf4230cb9a070e8f7e927acecd70b14a7") (baseRefName . "master") (headRefName . "OBR-960") (isDraft) (databaseId . 1226447524) (number . 198) (createdAt . "2023-02-02T11:51:08Z") (updatedAt . "2023-02-02T17:07:22Z") (latestOpinionatedReviews (nodes ((author (login . "chrishowejones") (url . "https://github.com/chrishowejones")) (createdAt . "2023-02-02T17:07:22Z") (state . "APPROVED")) ((author (login . "EduardoMRB") (url . "https://github.com/EduardoMRB")) (createdAt . "2023-02-02T12:53:00Z") (state . "APPROVED")))) (reviewRequests (nodes)) (files (nodes ((path . "bases/space-invader/src/main/app/ui/tag.cljs") (additions . 5) (deletions . 4)))) (milestone) (labels (nodes)) (assignees (nodes)) (projectCards (nodes)) (suggestedReviewers) (commits (totalCount . 1) (nodes ((commit (abbreviatedOid . "4a5799f") (message . "[OBR-960] fix link edit for CKEditor in modal") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-02-02T11:51:21Z") (completedAt . "2023-02-02T11:55:16Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4074164873/jobs/7018972348") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-02-02T11:51:20Z") (completedAt . "2023-02-02T11:52:03Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4074164873/jobs/7018972472") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-02-02T11:51:21Z") (completedAt . "2023-02-02T11:52:18Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4074164873/jobs/7018972634") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-02-02T11:51:20Z") (completedAt . "2023-02-02T11:52:10Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4074164873/jobs/7018972772") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))))) (title . "[OBR-960] fix link edit for CKEditor in modal") (state . "MERGED") (bodyHTML . "<p dir=\"auto\">The problem was that with <code class=\"notranslate\">focusLock</code> on, focus was prevented (by the modal) from being passed to elements outside the modal; this affects the link edit for CKE which is created by CKE at the bottom of the DOM</p>") (bodyText . "The problem was that with focusLock on, focus was prevented (by the modal) from being passed to elements outside the modal; this affects the link edit for CKE which is created by CKE at the bottom of the DOM") (reactions (nodes)) (comments (nodes)) (reviews (nodes ((typename . "PullRequestReview") (author (login . "EduardoMRB")) (bodyHTML . "<p dir=\"auto\">LGTM!</p>") (state . "APPROVED") (createdAt . "2023-02-02T12:53:00Z") (databaseId . 1281001232) (updatedAt . "2023-02-02T12:53:00Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "chrishowejones")) (bodyHTML . "") (state . "APPROVED") (createdAt . "2023-02-02T17:07:22Z") (databaseId . 1281492143) (updatedAt . "2023-02-02T17:07:22Z") (comments (nodes)))))) "diff --git bases/space-invader/src/main/app/ui/tag.cljs bases/space-invader/src/main/app/ui/tag.cljs
index 21ccf1cb..514b4900 100644
--- bases/space-invader/src/main/app/ui/tag.cljs
+++ bases/space-invader/src/main/app/ui/tag.cljs
@@ -28,7 +28,8 @@
      :onClose #(m/toggle!! this :ui/editing?)
      :closeable true
      :animate true
-     :autoFocus true}
+     :autoFocus true
+     :focusLock false}
     (modal/modal-header {}
       \"Edit tag: \" tran)
     (modal/modal-body {}
@@ -45,18 +46,18 @@
            :value (or summary \"\")}))
       (inputs/form-control {:label \"Description\"}
         (components/ui-ck-editor
-          {:value (or description)
+          {:value description
            :on-change #(m/set-string!! this :text/description :value %)
            :on-ready #(log/info \"Init\")}))
       (inputs/form-control {:label \"Learning Outcomes\"}
         (inputs/textarea
           {:id (str \"learning-outcomes-\" id)
-           :value (or learning-outcomes)
+           :value (or learning-outcomes \"\")
            :onChange #(m/set-string!! this :text/learning-outcomes :event %)}))
       (inputs/form-control {:label \"Info\"}
         (inputs/textarea
           {:id (str \"info-\" id)
-           :value (or info)
+           :value (or info \"\")
            :onChange #(m/set-string!! this :text/info :event %)})))
     (modal/modal-footer {}
       (modal/modal-button {:kind \"tertiary\" :onClick #(m/toggle!! this :ui/editing?)}" (((typename . "PullRequestReview") (author (login . "EduardoMRB")) (bodyHTML . "<p dir=\"auto\">LGTM!</p>") (state . "APPROVED") (createdAt . "2023-02-02T12:53:00Z") (databaseId . 1281001232) (updatedAt . "2023-02-02T12:53:00Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "chrishowejones")) (bodyHTML . "") (state . "APPROVED") (createdAt . "2023-02-02T17:07:22Z") (databaseId . 1281492143) (updatedAt . "2023-02-02T17:07:22Z") (comments (nodes)))) "cambioscience" "obrizum" "198" "<p dir=\"auto\">The problem was that with <code class=\"notranslate\">focusLock</code> on, focus was prevented (by the modal) from being passed to elements outside the modal; this affects the link edit for CKE which is created by CKE at the bottom of the DOM</p>" "[OBR-960] fix link edit for CKEditor in modal" nil "4a5799fbf4230cb9a070e8f7e927acecd70b14a7" nil "MERGED" nil nil nil nil ((title) (perc) (number)) nil nil nil nil eieio--unbound nil) code-review-section-full-refresh? code-review-buffer-name t eieio-oset finished finished-at current-time-string code-review-db-update code-review--build-buffer nil "Done submitting review"] 5 "

(fn &rest _)"] code-review-github-errback nil nil))

Wed Feb  8 16:30:54 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 16:31:17 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 16:31:36 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 16:44:35 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 16:46:12 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 16:54:15 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 16:55:36 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 16:58:04 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 16:58:40 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 17:12:07 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 17:12:49 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 17:13:09 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 17:13:14 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 17:13:56 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Wed Feb  8 17:14:18 2023 - code-review--build-buffer - (wrong-number-of-arguments (6 . 7) 8)

Thu Apr  6 09:28:14 2023 - code-review-github-errback - ((error http 422 ((message . "Unprocessable Entity") (errors "You need to leave a comment indicating the requested changes.") (documentation_url . "https://docs.github.com/rest/reference/pulls#create-a-review-for-a-pull-request"))) (("Server" . "GitHub.com") ("Date" . "Thu, 06 Apr 2023 08:28:14 GMT") ("Content-Type" . "application/json; charset=utf-8") ("Content-Length" . "211") ("X-OAuth-Scopes" . "read:org, repo, user") ("X-GitHub-Media-Type" . "github.v3; format=json") ("x-github-api-version-selected" . "2022-11-28") ("X-RateLimit-Limit" . "5000") ("X-RateLimit-Remaining" . "4998") ("X-RateLimit-Reset" . "1680773209") ("X-RateLimit-Used" . "2") ("X-RateLimit-Resource" . "core") ("Access-Control-Expose-Headers" . "ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, X-GitHub-SSO, X-GitHub-Request-Id, Deprecation, Sunset") ("Access-Control-Allow-Origin" . "*") ("Strict-Transport-Security" . "max-age=31536000; includeSubdomains; preload") ("X-Frame-Options" . "deny") ("X-Content-Type-Options" . "nosniff") ("X-XSS-Protection" . "0") ("Referrer-Policy" . "origin-when-cross-origin, strict-origin-when-cross-origin") ("Content-Security-Policy" . "default-src 'none'") ("Vary" . "Accept-Encoding, Accept, X-Requested-With") ("X-GitHub-Request-Id" . "E680:357A:438CEA4:4436189:642E824A")) (:error (error http 422 ((message . "Unprocessable Entity") (errors "You need to leave a comment indicating the requested changes.") (documentation_url . "https://docs.github.com/rest/reference/pulls#create-a-review-for-a-pull-request"))) :peer (:certificates ((:version 3 :serial-number "0b:89:05:37:12:5f:45:10:d6:37:2a:10:28:a9:29:a5" :issuer "C=US,O=DigiCert Inc,CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1" :valid-from "2023-02-16" :valid-to "2024-03-15" :subject "C=US,ST=California,L=San Francisco,O=GitHub\\, Inc.,CN=*.github.com" :public-key-algorithm "EC/ECDSA" :certificate-security-level "High" :signature-algorithm "ECDSA-SHA384" :public-key-id "sha1:b6:3f:03:4b:19:b5:09:31:ad:35:c2:7b:0c:10:5b:e3:49:f4:14:3b" :certificate-id "sha1:2d:79:6c:90:2d:ad:8a:2e:4f:d1:e2:99:ed:e8:91:29:36:40:f8:58" :pem "-----BEGIN CERTIFICATE-----
MIIFaTCCBO+gAwIBAgIQC4kFNxJfRRDWNyoQKKkppTAKBggqhkjOPQQDAzBWMQsw
CQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMTAwLgYDVQQDEydEaWdp
Q2VydCBUTFMgSHlicmlkIEVDQyBTSEEzODQgMjAyMCBDQTEwHhcNMjMwMjE2MDAw
MDAwWhcNMjQwMzE1MjM1OTU5WjBoMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2Fs
aWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZyYW5jaXNjbzEVMBMGA1UEChMMR2l0SHVi
LCBJbmMuMRUwEwYDVQQDDAwqLmdpdGh1Yi5jb20wWTATBgcqhkjOPQIBBggqhkjO
PQMBBwNCAARUH0Nrue1CP3dESL1ihStO87/CuTPEuV5esOMkZ7U4je2yuT5xZtlg
BvAvq6duFmwCpvIFyvkEcrkze/FlVIZGo4IDizCCA4cwHwYDVR0jBBgwFoAUCrwI
KReMpTlteg7OM8cus+37w3owHQYDVR0OBBYEFDwu28aLLUMbaoExfeOXEcn3+OsI
MCMGA1UdEQQcMBqCDCouZ2l0aHViLmNvbYIKZ2l0aHViLmNvbTAOBgNVHQ8BAf8E
BAMCB4AwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMIGbBgNVHR8EgZMw
gZAwRqBEoEKGQGh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5
YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5jcmwwRqBEoEKGQGh0dHA6Ly9jcmw0LmRp
Z2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5j
cmwwPgYDVR0gBDcwNTAzBgZngQwBAgIwKTAnBggrBgEFBQcCARYbaHR0cDovL3d3
dy5kaWdpY2VydC5jb20vQ1BTMIGFBggrBgEFBQcBAQR5MHcwJAYIKwYBBQUHMAGG
GGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBPBggrBgEFBQcwAoZDaHR0cDovL2Nh
Y2VydHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0VExTSHlicmlkRUNDU0hBMzg0MjAy
MENBMS0xLmNydDAJBgNVHRMEAjAAMIIBfgYKKwYBBAHWeQIEAgSCAW4EggFqAWgA
dgDuzdBk1dsazsVct520zROiModGfLzs3sNRSFlGcR+1mwAAAYZbCs3zAAAEAwBH
MEUCIArGXZDo62J6BVdPjIPk+H7q9+UoVANmnCejGAGKR1XRAiEAm7ggdSeB2Mu8
XgzTT4mTL/KR3WHXHkqdbPXt8nXYWyMAdgBz2Z6JG0yWeKAgfUed5rLGHNBRXnEZ
KoxrgBB6wXdytQAAAYZbCs5IAAAEAwBHMEUCIGxWpr58dem8sgHumQBm+cysaKAn
xb9/5uOr29yhALEgAiEAz6/uoCrCHtiOEjToUUyQUoWvIS2yxCRuJ5a229RZ468A
dgBIsONr2qZHNA/lagL6nTDrHFIBy1bdLIHZu7+rOdiEcwAAAYZbCs4BAAAEAwBH
MEUCIQCKTfSwHfwxDHXZXeglt7MuunJiK1Z5ZqlbKbrNxsGjawIgM/JYG7f3HFlB
DO9XyrPKcZs5zUCuWfeej5FbKjgmTnQwCgYIKoZIzj0EAwMDaAAwZQIwMUgizPft
BREzRzfvZU26bzV3khG+tLUSl5vETtKiZvO9DFRkrfgE5OwJqqe6XdXXAjEA+3jK
aW4/QLTPHGYSiBZZswDEGpwwpn0khV/v2JdSjqqcO0bRiy2O6grh9+/JzgXr
-----END CERTIFICATE-----
") (:version 3 :serial-number "07:f2:f3:5c:87:a8:77:af:7a:ef:e9:47:99:35:25:bd" :issuer "C=US,O=DigiCert Inc,OU=www.digicert.com,CN=DigiCert Global Root CA" :valid-from "2021-04-14" :valid-to "2031-04-13" :subject "C=US,O=DigiCert Inc,CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1" :public-key-algorithm "EC/ECDSA" :certificate-security-level "Ultra" :signature-algorithm "RSA-SHA384" :public-key-id "sha1:3f:a4:c2:7e:9c:9c:89:2c:6b:98:6c:1c:3e:1f:40:20:49:d4:48:5f" :certificate-id "sha1:ae:c1:3c:dd:5e:a6:a3:99:8a:ec:14:ac:33:1a:d9:6b:ed:bb:77:0f" :pem "-----BEGIN CERTIFICATE-----
MIIEFzCCAv+gAwIBAgIQB/LzXIeod6967+lHmTUlvTANBgkqhkiG9w0BAQwFADBh
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD
QTAeFw0yMTA0MTQwMDAwMDBaFw0zMTA0MTMyMzU5NTlaMFYxCzAJBgNVBAYTAlVT
MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxMDAuBgNVBAMTJ0RpZ2lDZXJ0IFRMUyBI
eWJyaWQgRUNDIFNIQTM4NCAyMDIwIENBMTB2MBAGByqGSM49AgEGBSuBBAAiA2IA
BMEbxppbmNmkKaDp1AS12+umsmxVwP/tmMZJLwYnUcu/cMEFesOxnYeJuq20ExfJ
qLSDyLiQ0cx0NTY8g3KwtdD3ImnI8YDEe0CPz2iHJlw5ifFNkU3aiYvkA8ND5b8v
c6OCAYIwggF+MBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFAq8CCkXjKU5
bXoOzjPHLrPt+8N6MB8GA1UdIwQYMBaAFAPeUDVW0Uy7ZvCj4hsbw5eyPdFVMA4G
A1UdDwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwdgYI
KwYBBQUHAQEEajBoMCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5kaWdpY2VydC5j
b20wQAYIKwYBBQUHMAKGNGh0dHA6Ly9jYWNlcnRzLmRpZ2ljZXJ0LmNvbS9EaWdp
Q2VydEdsb2JhbFJvb3RDQS5jcnQwQgYDVR0fBDswOTA3oDWgM4YxaHR0cDovL2Ny
bDMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0R2xvYmFsUm9vdENBLmNybDA9BgNVHSAE
NjA0MAsGCWCGSAGG/WwCATAHBgVngQwBATAIBgZngQwBAgEwCAYGZ4EMAQICMAgG
BmeBDAECAzANBgkqhkiG9w0BAQwFAAOCAQEAR1mBf9QbH7Bx9phdGLqYR5iwfnYr
6v8ai6wms0KNMeZK6BnQ79oU59cUkqGS8qcuLa/7Hfb7U7CKP/zYFgrpsC62pQsY
kDUmotr2qLcy/JUjS8ZFucTP5Hzu5sn4kL1y45nDHQsFfGqXbbKrAjbYwrwsAZI/
BKOLdRHHuSm8EdCGupK8JvllyDfNJvaGEwwEqonleLHBTnm8dqMLUeTF0J5q/hos
Vq4GNiejcxwIfZMy0MJEGdqN9A57HSgDKwmKdsp33Id6rHtSJlWncg+d0ohP/rEh
xRqhqjn1VtvChMQ1H3Dau0bwhr9kAMQ+959GG50jBbl9s08PqUU643QwmA==
-----END CERTIFICATE-----
")) :certificate (:version 3 :serial-number "0b:89:05:37:12:5f:45:10:d6:37:2a:10:28:a9:29:a5" :issuer "C=US,O=DigiCert Inc,CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1" :valid-from "2023-02-16" :valid-to "2024-03-15" :subject "C=US,ST=California,L=San Francisco,O=GitHub\\, Inc.,CN=*.github.com" :public-key-algorithm "EC/ECDSA" :certificate-security-level "High" :signature-algorithm "ECDSA-SHA384" :public-key-id "sha1:b6:3f:03:4b:19:b5:09:31:ad:35:c2:7b:0c:10:5b:e3:49:f4:14:3b" :certificate-id "sha1:2d:79:6c:90:2d:ad:8a:2e:4f:d1:e2:99:ed:e8:91:29:36:40:f8:58" :pem "-----BEGIN CERTIFICATE-----
MIIFaTCCBO+gAwIBAgIQC4kFNxJfRRDWNyoQKKkppTAKBggqhkjOPQQDAzBWMQsw
CQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMTAwLgYDVQQDEydEaWdp
Q2VydCBUTFMgSHlicmlkIEVDQyBTSEEzODQgMjAyMCBDQTEwHhcNMjMwMjE2MDAw
MDAwWhcNMjQwMzE1MjM1OTU5WjBoMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2Fs
aWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZyYW5jaXNjbzEVMBMGA1UEChMMR2l0SHVi
LCBJbmMuMRUwEwYDVQQDDAwqLmdpdGh1Yi5jb20wWTATBgcqhkjOPQIBBggqhkjO
PQMBBwNCAARUH0Nrue1CP3dESL1ihStO87/CuTPEuV5esOMkZ7U4je2yuT5xZtlg
BvAvq6duFmwCpvIFyvkEcrkze/FlVIZGo4IDizCCA4cwHwYDVR0jBBgwFoAUCrwI
KReMpTlteg7OM8cus+37w3owHQYDVR0OBBYEFDwu28aLLUMbaoExfeOXEcn3+OsI
MCMGA1UdEQQcMBqCDCouZ2l0aHViLmNvbYIKZ2l0aHViLmNvbTAOBgNVHQ8BAf8E
BAMCB4AwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMIGbBgNVHR8EgZMw
gZAwRqBEoEKGQGh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5
YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5jcmwwRqBEoEKGQGh0dHA6Ly9jcmw0LmRp
Z2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5j
cmwwPgYDVR0gBDcwNTAzBgZngQwBAgIwKTAnBggrBgEFBQcCARYbaHR0cDovL3d3
dy5kaWdpY2VydC5jb20vQ1BTMIGFBggrBgEFBQcBAQR5MHcwJAYIKwYBBQUHMAGG
GGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBPBggrBgEFBQcwAoZDaHR0cDovL2Nh
Y2VydHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0VExTSHlicmlkRUNDU0hBMzg0MjAy
MENBMS0xLmNydDAJBgNVHRMEAjAAMIIBfgYKKwYBBAHWeQIEAgSCAW4EggFqAWgA
dgDuzdBk1dsazsVct520zROiModGfLzs3sNRSFlGcR+1mwAAAYZbCs3zAAAEAwBH
MEUCIArGXZDo62J6BVdPjIPk+H7q9+UoVANmnCejGAGKR1XRAiEAm7ggdSeB2Mu8
XgzTT4mTL/KR3WHXHkqdbPXt8nXYWyMAdgBz2Z6JG0yWeKAgfUed5rLGHNBRXnEZ
KoxrgBB6wXdytQAAAYZbCs5IAAAEAwBHMEUCIGxWpr58dem8sgHumQBm+cysaKAn
xb9/5uOr29yhALEgAiEAz6/uoCrCHtiOEjToUUyQUoWvIS2yxCRuJ5a229RZ468A
dgBIsONr2qZHNA/lagL6nTDrHFIBy1bdLIHZu7+rOdiEcwAAAYZbCs4BAAAEAwBH
MEUCIQCKTfSwHfwxDHXZXeglt7MuunJiK1Z5ZqlbKbrNxsGjawIgM/JYG7f3HFlB
DO9XyrPKcZs5zUCuWfeej5FbKjgmTnQwCgYIKoZIzj0EAwMDaAAwZQIwMUgizPft
BREzRzfvZU26bzV3khG+tLUSl5vETtKiZvO9DFRkrfgE5OwJqqe6XdXXAjEA+3jK
aW4/QLTPHGYSiBZZswDEGpwwpn0khV/v2JdSjqqcO0bRiy2O6grh9+/JzgXr
-----END CERTIFICATE-----
") :key-exchange "ECDHE-RSA" :protocol "TLS1.3" :cipher "AES-128-GCM" :mac "AEAD" :encrypt-then-mac nil)) #s(ghub--req #s(url "https" nil nil "api.github.com" nil "/repos/cambioscience/obrizum/pulls/320/reviews" nil nil t nil t t) nil nil "POST" (closure ((forge) (username . "chrishowejones") (auth . code-review) (host . "api.github.com") (headers ("Content-Type" . "application/json")) cl-struct-ghub--req-tags url-http-response-status url-http-extra-headers url-http-end-of-headers url-callback-arguments t) nil (if (eq auth 'basic) (cons (cons "Authorization" (ghub--basic-auth host username)) headers) (cons (ghub--auth host auth username forge) headers))) ghub--handle-response nil t nil (closure ((local-comments) (replies) (replies-obj . #s(code-review-submit-github-replies #s(#s(eieio--class code-review-github-repo nil (#s(eieio--class code-review-db-pullreq nil (#s(eieio--class closql-object nil nil [#s(cl-slot-descriptor closql-database nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1)) (forge-object code-review-db-pullreq code-review-db-comment code-review-db-path code-review-db-buffer) ((:closql-database . closql-database)) [#s(cl-slot-descriptor closql-order-by nil t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key nil t nil) #s(cl-slot-descriptor closql-table nil t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix nil t nil)] [nil nil nil nil nil nil] #s(#11 nil) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer)))] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30)) (code-review-bitbucket-repo code-review-gitlab-repo code-review-github-repo) ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-class-prefix "code-review-" t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-order-by [(desc number)] t nil)] ["code-review-" nil pullreq id nil [(desc number)]] #s(#9 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer))) #s(cl-slot-descriptor callback nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30 callback 31)) nil ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-order-by [(desc number)] t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix "code-review-" t nil)] [[(desc number)] nil id pullreq nil "code-review-"] #s(#7 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound nil) (:custom-groups nil)) #s(code-review-db-database #<process emacsql-sqlite<1>> #<buffer  *emacsql-log*-621227> #<finalizer> "/home/chris/.emacs.d/code-review-db-file.sqlite") "e52b6418-8937-4eea-8bd1-1b67e7a3c4d4" "master" "OBR-1050-Registrations-in-Metabase-Persons-table" nil nil nil nil ((id . "PR_kwDOFQcPnc5NjyMK") (author (login . "dattan010280") (url . "https://github.com/dattan010280")) (headRefOid . "f879b9ec3abbba7388ead04d317214bf3d8cec81") (baseRefName . "master") (headRefName . "OBR-1050-Registrations-in-Metabase-Persons-table") (isDraft) (databaseId . 1301226250) (number . 320) (createdAt . "2023-04-04T07:58:54Z") (updatedAt . "2023-04-06T02:14:54Z") (latestOpinionatedReviews (nodes ((author (login . "chenlilyd") (url . "https://github.com/chenlilyd")) (createdAt . "2023-04-05T10:45:02Z") (state . "APPROVED")) ((author (login . "aibrahim") (url . "https://github.com/aibrahim")) (createdAt . "2023-04-05T08:09:31Z") (state . "APPROVED")))) (reviewRequests (nodes)) (files (nodes ((path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (additions . 9) (deletions . 0)) ((path . "bases/space-invader/src/main/app/model/user_metric.clj") (additions . 1) (deletions . 1)))) (milestone) (labels (nodes)) (assignees (nodes)) (projectCards (nodes)) (suggestedReviewers) (commits (totalCount . 2) (nodes ((commit (abbreviatedOid . "b9cf554") (message . "OBR-1050-Registrations-in-Metabase-Persons-table") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T08:03:27Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137312971") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T07:59:45Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313144") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:02Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313296") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:08Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313467") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))) ((commit (abbreviatedOid . "f879b9e") (message . "OBR-1050-Update on Abdullah's comment") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-06T02:14:33Z") (completedAt . "2023-04-06T02:19:08Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179857874") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858003") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858127") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:32Z") (completedAt . "2023-04-06T02:15:19Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858243") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))))) (title . "[OBR-1050] Registrations-in-Metabase-Persons-table") (state . "OPEN") (bodyHTML . "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>") (bodyText . "Hello Team,
Please help to review this for OBR-1050. Thanks.

Add store-new-users-to-metrics for new Gas Safe Invitations") (reactions (nodes)) (comments (nodes)) (reviews (nodes ((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))))) "diff --git bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
index dd54e630..19d1e4bc 100644
--- bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
+++ bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
@@ -1,5 +1,6 @@
 (ns app.model.user-membership.gas-safe-invitations
   (:require
+   [app.model.user-metric :as user-metric]
    [app.server-components.client :as client]
    [app.utils :as utils]
    [buddy.sign.jwt :as jwt]
@@ -211,6 +212,13 @@
     ctx
     (flow/fail-with {:msg \"No users to invite\"})))
 
+(defn save-registration-metrics!
+  [{:keys [users db conn] :as params}]
+  (->> users
+       (mapv :person/uuid)
+       (user-metric/store-new-users-to-metrics conn db)
+       (merge params)))
+
 (defmutation start-invitations
   [{:keys [conn db]} {:keys [csv-users description]}]
   {::pc/params [:csv-users]
@@ -225,6 +233,7 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call save-registration-metrics!)
     (flow/then-call create-invitation-session)
     (flow/then start-session)
     (flow/then (fn [{:keys [invitation]}]
diff --git bases/space-invader/src/main/app/model/user_metric.clj bases/space-invader/src/main/app/model/user_metric.clj
index e4dd94a1..d5111a24 100644
--- bases/space-invader/src/main/app/model/user_metric.clj
+++ bases/space-invader/src/main/app/model/user_metric.clj
@@ -24,7 +24,7 @@
           _ (log/info \"Transact user-metric [person-account-registered] into Datomic\")
           {:keys [db-after]} (d/transact conn {:tx-data tx-data})]
       (if db-after
-        {:user-metric/saved? true}
+        {:user-metric/saved? true :db db-after}
         (throw (ex-info (str \"Invited users metric transaction failed\")
                         {:user-metric/saved? false}))))
     (catch Exception e" (((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))) "cambioscience" "obrizum" "320" "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>" "[OBR-1050] Registrations-in-Metabase-Persons-table" nil "f879b9ec3abbba7388ead04d317214bf3d8cec81" nil "OPEN" nil nil nil nil ((title) (perc) (number)) nil nil nil nil eieio--unbound nil) nil)) (review-obj . #s(code-review-submit-github-review "COMMENT" #s(#s(eieio--class code-review-github-repo nil (#s(eieio--class code-review-db-pullreq nil (#s(eieio--class closql-object nil nil [#s(cl-slot-descriptor closql-database nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1)) (forge-object code-review-db-pullreq code-review-db-comment code-review-db-path code-review-db-buffer) ((:closql-database . closql-database)) [#s(cl-slot-descriptor closql-order-by nil t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key nil t nil) #s(cl-slot-descriptor closql-table nil t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix nil t nil)] [nil nil nil nil nil nil] #s(#11 nil) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer)))] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30)) (code-review-bitbucket-repo code-review-gitlab-repo code-review-github-repo) ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-class-prefix "code-review-" t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-order-by [(desc number)] t nil)] ["code-review-" nil pullreq id nil [(desc number)]] #s(#9 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer))) #s(cl-slot-descriptor callback nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30 callback 31)) nil ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-order-by [(desc number)] t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix "code-review-" t nil)] [[(desc number)] nil id pullreq nil "code-review-"] #s(#7 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound nil) (:custom-groups nil)) #s(code-review-db-database #<process emacsql-sqlite<1>> #<buffer  *emacsql-log*-621227> #<finalizer> "/home/chris/.emacs.d/code-review-db-file.sqlite") "e52b6418-8937-4eea-8bd1-1b67e7a3c4d4" "master" "OBR-1050-Registrations-in-Metabase-Persons-table" nil nil nil nil ((id . "PR_kwDOFQcPnc5NjyMK") (author (login . "dattan010280") (url . "https://github.com/dattan010280")) (headRefOid . "f879b9ec3abbba7388ead04d317214bf3d8cec81") (baseRefName . "master") (headRefName . "OBR-1050-Registrations-in-Metabase-Persons-table") (isDraft) (databaseId . 1301226250) (number . 320) (createdAt . "2023-04-04T07:58:54Z") (updatedAt . "2023-04-06T02:14:54Z") (latestOpinionatedReviews (nodes ((author (login . "chenlilyd") (url . "https://github.com/chenlilyd")) (createdAt . "2023-04-05T10:45:02Z") (state . "APPROVED")) ((author (login . "aibrahim") (url . "https://github.com/aibrahim")) (createdAt . "2023-04-05T08:09:31Z") (state . "APPROVED")))) (reviewRequests (nodes)) (files (nodes ((path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (additions . 9) (deletions . 0)) ((path . "bases/space-invader/src/main/app/model/user_metric.clj") (additions . 1) (deletions . 1)))) (milestone) (labels (nodes)) (assignees (nodes)) (projectCards (nodes)) (suggestedReviewers) (commits (totalCount . 2) (nodes ((commit (abbreviatedOid . "b9cf554") (message . "OBR-1050-Registrations-in-Metabase-Persons-table") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T08:03:27Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137312971") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T07:59:45Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313144") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:02Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313296") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:08Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313467") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))) ((commit (abbreviatedOid . "f879b9e") (message . "OBR-1050-Update on Abdullah's comment") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-06T02:14:33Z") (completedAt . "2023-04-06T02:19:08Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179857874") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858003") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858127") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:32Z") (completedAt . "2023-04-06T02:15:19Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858243") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))))) (title . "[OBR-1050] Registrations-in-Metabase-Persons-table") (state . "OPEN") (bodyHTML . "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>") (bodyText . "Hello Team,
Please help to review this for OBR-1050. Thanks.

Add store-new-users-to-metrics for new Gas Safe Invitations") (reactions (nodes)) (comments (nodes)) (reviews (nodes ((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))))) "diff --git bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
index dd54e630..19d1e4bc 100644
--- bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
+++ bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
@@ -1,5 +1,6 @@
 (ns app.model.user-membership.gas-safe-invitations
   (:require
+   [app.model.user-metric :as user-metric]
    [app.server-components.client :as client]
    [app.utils :as utils]
    [buddy.sign.jwt :as jwt]
@@ -211,6 +212,13 @@
     ctx
     (flow/fail-with {:msg \"No users to invite\"})))
 
+(defn save-registration-metrics!
+  [{:keys [users db conn] :as params}]
+  (->> users
+       (mapv :person/uuid)
+       (user-metric/store-new-users-to-metrics conn db)
+       (merge params)))
+
 (defmutation start-invitations
   [{:keys [conn db]} {:keys [csv-users description]}]
   {::pc/params [:csv-users]
@@ -225,6 +233,7 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call save-registration-metrics!)
     (flow/then-call create-invitation-session)
     (flow/then start-session)
     (flow/then (fn [{:keys [invitation]}]
diff --git bases/space-invader/src/main/app/model/user_metric.clj bases/space-invader/src/main/app/model/user_metric.clj
index e4dd94a1..d5111a24 100644
--- bases/space-invader/src/main/app/model/user_metric.clj
+++ bases/space-invader/src/main/app/model/user_metric.clj
@@ -24,7 +24,7 @@
           _ (log/info \"Transact user-metric [person-account-registered] into Datomic\")
           {:keys [db-after]} (d/transact conn {:tx-data tx-data})]
       (if db-after
-        {:user-metric/saved? true}
+        {:user-metric/saved? true :db db-after}
         (throw (ex-info (str \"Invited users metric transaction failed\")
                         {:user-metric/saved? false}))))
     (catch Exception e" (((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))) "cambioscience" "obrizum" "320" "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>" "[OBR-1050] Registrations-in-Metabase-Persons-table" nil "f879b9ec3abbba7388ead04d317214bf3d8cec81" nil "OPEN" nil nil nil nil ((title) (perc) (number)) nil nil nil nil eieio--unbound nil) nil nil)) (pr . #s(#s(eieio--class code-review-github-repo nil (#s(eieio--class code-review-db-pullreq nil (#s(eieio--class closql-object nil nil [#s(cl-slot-descriptor closql-database nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1)) (forge-object code-review-db-pullreq code-review-db-comment code-review-db-path code-review-db-buffer) ((:closql-database . closql-database)) [#s(cl-slot-descriptor closql-order-by nil t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key nil t nil) #s(cl-slot-descriptor closql-table nil t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix nil t nil)] [nil nil nil nil nil nil] #s(#10 nil) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer)))] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30)) (code-review-bitbucket-repo code-review-gitlab-repo code-review-github-repo) ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-class-prefix "code-review-" t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-order-by [(desc number)] t nil)] ["code-review-" nil pullreq id nil [(desc number)]] #s(#8 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer))) #s(cl-slot-descriptor callback nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30 callback 31)) nil ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-order-by [(desc number)] t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix "code-review-" t nil)] [[(desc number)] nil id pullreq nil "code-review-"] #s(#6 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound nil) (:custom-groups nil)) #s(code-review-db-database #<process emacsql-sqlite<1>> #<buffer  *emacsql-log*-621227> #<finalizer> "/home/chris/.emacs.d/code-review-db-file.sqlite") "e52b6418-8937-4eea-8bd1-1b67e7a3c4d4" "master" "OBR-1050-Registrations-in-Metabase-Persons-table" nil nil nil nil ((id . "PR_kwDOFQcPnc5NjyMK") (author (login . "dattan010280") (url . "https://github.com/dattan010280")) (headRefOid . "f879b9ec3abbba7388ead04d317214bf3d8cec81") (baseRefName . "master") (headRefName . "OBR-1050-Registrations-in-Metabase-Persons-table") (isDraft) (databaseId . 1301226250) (number . 320) (createdAt . "2023-04-04T07:58:54Z") (updatedAt . "2023-04-06T02:14:54Z") (latestOpinionatedReviews (nodes ((author (login . "chenlilyd") (url . "https://github.com/chenlilyd")) (createdAt . "2023-04-05T10:45:02Z") (state . "APPROVED")) ((author (login . "aibrahim") (url . "https://github.com/aibrahim")) (createdAt . "2023-04-05T08:09:31Z") (state . "APPROVED")))) (reviewRequests (nodes)) (files (nodes ((path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (additions . 9) (deletions . 0)) ((path . "bases/space-invader/src/main/app/model/user_metric.clj") (additions . 1) (deletions . 1)))) (milestone) (labels (nodes)) (assignees (nodes)) (projectCards (nodes)) (suggestedReviewers) (commits (totalCount . 2) (nodes ((commit (abbreviatedOid . "b9cf554") (message . "OBR-1050-Registrations-in-Metabase-Persons-table") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T08:03:27Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137312971") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T07:59:45Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313144") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:02Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313296") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:08Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313467") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))) ((commit (abbreviatedOid . "f879b9e") (message . "OBR-1050-Update on Abdullah's comment") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-06T02:14:33Z") (completedAt . "2023-04-06T02:19:08Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179857874") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858003") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858127") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:32Z") (completedAt . "2023-04-06T02:15:19Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858243") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))))) (title . "[OBR-1050] Registrations-in-Metabase-Persons-table") (state . "OPEN") (bodyHTML . "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>") (bodyText . "Hello Team,
Please help to review this for OBR-1050. Thanks.

Add store-new-users-to-metrics for new Gas Safe Invitations") (reactions (nodes)) (comments (nodes)) (reviews (nodes ((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))))) "diff --git bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
index dd54e630..19d1e4bc 100644
--- bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
+++ bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
@@ -1,5 +1,6 @@
 (ns app.model.user-membership.gas-safe-invitations
   (:require
+   [app.model.user-metric :as user-metric]
    [app.server-components.client :as client]
    [app.utils :as utils]
    [buddy.sign.jwt :as jwt]
@@ -211,6 +212,13 @@
     ctx
     (flow/fail-with {:msg \"No users to invite\"})))
 
+(defn save-registration-metrics!
+  [{:keys [users db conn] :as params}]
+  (->> users
+       (mapv :person/uuid)
+       (user-metric/store-new-users-to-metrics conn db)
+       (merge params)))
+
 (defmutation start-invitations
   [{:keys [conn db]} {:keys [csv-users description]}]
   {::pc/params [:csv-users]
@@ -225,6 +233,7 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call save-registration-metrics!)
     (flow/then-call create-invitation-session)
     (flow/then start-session)
     (flow/then (fn [{:keys [invitation]}]
diff --git bases/space-invader/src/main/app/model/user_metric.clj bases/space-invader/src/main/app/model/user_metric.clj
index e4dd94a1..d5111a24 100644
--- bases/space-invader/src/main/app/model/user_metric.clj
+++ bases/space-invader/src/main/app/model/user_metric.clj
@@ -24,7 +24,7 @@
           _ (log/info \"Transact user-metric [person-account-registered] into Datomic\")
           {:keys [db-after]} (d/transact conn {:tx-data tx-data})]
       (if db-after
-        {:user-metric/saved? true}
+        {:user-metric/saved? true :db db-after}
         (throw (ex-info (str \"Invited users metric transaction failed\")
                         {:user-metric/saved? false}))))
     (catch Exception e" (((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))) "cambioscience" "obrizum" "320" "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>" "[OBR-1050] Registrations-in-Metabase-Persons-table" nil "f879b9ec3abbba7388ead04d317214bf3d8cec81" nil "OPEN" nil nil nil nil ((title) (perc) (number)) nil nil nil nil eieio--unbound nil)) (only-reply?) (feedback) (event . "COMMENT") t) (&rest _) (let ((code-review-section-full-refresh? t)) (eieio-oset pr 'finished t) (eieio-oset pr 'finished-at (current-time-string)) (code-review-db-update pr) (code-review--build-buffer code-review-buffer-name nil "Done submitting review"))) code-review-github-errback nil nil))

Thu Apr  6 09:28:39 2023 - code-review-github-errback - ((error http 422 ((message . "Unprocessable Entity") (errors "You need to leave a comment indicating the requested changes.") (documentation_url . "https://docs.github.com/rest/reference/pulls#create-a-review-for-a-pull-request"))) (("Server" . "GitHub.com") ("Date" . "Thu, 06 Apr 2023 08:28:38 GMT") ("Content-Type" . "application/json; charset=utf-8") ("Content-Length" . "211") ("X-OAuth-Scopes" . "read:org, repo, user") ("X-GitHub-Media-Type" . "github.v3; format=json") ("x-github-api-version-selected" . "2022-11-28") ("X-RateLimit-Limit" . "5000") ("X-RateLimit-Remaining" . "4997") ("X-RateLimit-Reset" . "1680773209") ("X-RateLimit-Used" . "3") ("X-RateLimit-Resource" . "core") ("Access-Control-Expose-Headers" . "ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, X-GitHub-SSO, X-GitHub-Request-Id, Deprecation, Sunset") ("Access-Control-Allow-Origin" . "*") ("Strict-Transport-Security" . "max-age=31536000; includeSubdomains; preload") ("X-Frame-Options" . "deny") ("X-Content-Type-Options" . "nosniff") ("X-XSS-Protection" . "0") ("Referrer-Policy" . "origin-when-cross-origin, strict-origin-when-cross-origin") ("Content-Security-Policy" . "default-src 'none'") ("Vary" . "Accept-Encoding, Accept, X-Requested-With") ("X-GitHub-Request-Id" . "E680:357A:4392941:443BCF3:642E829E")) (:error (error http 422 ((message . "Unprocessable Entity") (errors "You need to leave a comment indicating the requested changes.") (documentation_url . "https://docs.github.com/rest/reference/pulls#create-a-review-for-a-pull-request"))) :peer (:certificates ((:version 3 :serial-number "0b:89:05:37:12:5f:45:10:d6:37:2a:10:28:a9:29:a5" :issuer "C=US,O=DigiCert Inc,CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1" :valid-from "2023-02-16" :valid-to "2024-03-15" :subject "C=US,ST=California,L=San Francisco,O=GitHub\\, Inc.,CN=*.github.com" :public-key-algorithm "EC/ECDSA" :certificate-security-level "High" :signature-algorithm "ECDSA-SHA384" :public-key-id "sha1:b6:3f:03:4b:19:b5:09:31:ad:35:c2:7b:0c:10:5b:e3:49:f4:14:3b" :certificate-id "sha1:2d:79:6c:90:2d:ad:8a:2e:4f:d1:e2:99:ed:e8:91:29:36:40:f8:58" :pem "-----BEGIN CERTIFICATE-----
MIIFaTCCBO+gAwIBAgIQC4kFNxJfRRDWNyoQKKkppTAKBggqhkjOPQQDAzBWMQsw
CQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMTAwLgYDVQQDEydEaWdp
Q2VydCBUTFMgSHlicmlkIEVDQyBTSEEzODQgMjAyMCBDQTEwHhcNMjMwMjE2MDAw
MDAwWhcNMjQwMzE1MjM1OTU5WjBoMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2Fs
aWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZyYW5jaXNjbzEVMBMGA1UEChMMR2l0SHVi
LCBJbmMuMRUwEwYDVQQDDAwqLmdpdGh1Yi5jb20wWTATBgcqhkjOPQIBBggqhkjO
PQMBBwNCAARUH0Nrue1CP3dESL1ihStO87/CuTPEuV5esOMkZ7U4je2yuT5xZtlg
BvAvq6duFmwCpvIFyvkEcrkze/FlVIZGo4IDizCCA4cwHwYDVR0jBBgwFoAUCrwI
KReMpTlteg7OM8cus+37w3owHQYDVR0OBBYEFDwu28aLLUMbaoExfeOXEcn3+OsI
MCMGA1UdEQQcMBqCDCouZ2l0aHViLmNvbYIKZ2l0aHViLmNvbTAOBgNVHQ8BAf8E
BAMCB4AwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMIGbBgNVHR8EgZMw
gZAwRqBEoEKGQGh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5
YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5jcmwwRqBEoEKGQGh0dHA6Ly9jcmw0LmRp
Z2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5j
cmwwPgYDVR0gBDcwNTAzBgZngQwBAgIwKTAnBggrBgEFBQcCARYbaHR0cDovL3d3
dy5kaWdpY2VydC5jb20vQ1BTMIGFBggrBgEFBQcBAQR5MHcwJAYIKwYBBQUHMAGG
GGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBPBggrBgEFBQcwAoZDaHR0cDovL2Nh
Y2VydHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0VExTSHlicmlkRUNDU0hBMzg0MjAy
MENBMS0xLmNydDAJBgNVHRMEAjAAMIIBfgYKKwYBBAHWeQIEAgSCAW4EggFqAWgA
dgDuzdBk1dsazsVct520zROiModGfLzs3sNRSFlGcR+1mwAAAYZbCs3zAAAEAwBH
MEUCIArGXZDo62J6BVdPjIPk+H7q9+UoVANmnCejGAGKR1XRAiEAm7ggdSeB2Mu8
XgzTT4mTL/KR3WHXHkqdbPXt8nXYWyMAdgBz2Z6JG0yWeKAgfUed5rLGHNBRXnEZ
KoxrgBB6wXdytQAAAYZbCs5IAAAEAwBHMEUCIGxWpr58dem8sgHumQBm+cysaKAn
xb9/5uOr29yhALEgAiEAz6/uoCrCHtiOEjToUUyQUoWvIS2yxCRuJ5a229RZ468A
dgBIsONr2qZHNA/lagL6nTDrHFIBy1bdLIHZu7+rOdiEcwAAAYZbCs4BAAAEAwBH
MEUCIQCKTfSwHfwxDHXZXeglt7MuunJiK1Z5ZqlbKbrNxsGjawIgM/JYG7f3HFlB
DO9XyrPKcZs5zUCuWfeej5FbKjgmTnQwCgYIKoZIzj0EAwMDaAAwZQIwMUgizPft
BREzRzfvZU26bzV3khG+tLUSl5vETtKiZvO9DFRkrfgE5OwJqqe6XdXXAjEA+3jK
aW4/QLTPHGYSiBZZswDEGpwwpn0khV/v2JdSjqqcO0bRiy2O6grh9+/JzgXr
-----END CERTIFICATE-----
") (:version 3 :serial-number "07:f2:f3:5c:87:a8:77:af:7a:ef:e9:47:99:35:25:bd" :issuer "C=US,O=DigiCert Inc,OU=www.digicert.com,CN=DigiCert Global Root CA" :valid-from "2021-04-14" :valid-to "2031-04-13" :subject "C=US,O=DigiCert Inc,CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1" :public-key-algorithm "EC/ECDSA" :certificate-security-level "Ultra" :signature-algorithm "RSA-SHA384" :public-key-id "sha1:3f:a4:c2:7e:9c:9c:89:2c:6b:98:6c:1c:3e:1f:40:20:49:d4:48:5f" :certificate-id "sha1:ae:c1:3c:dd:5e:a6:a3:99:8a:ec:14:ac:33:1a:d9:6b:ed:bb:77:0f" :pem "-----BEGIN CERTIFICATE-----
MIIEFzCCAv+gAwIBAgIQB/LzXIeod6967+lHmTUlvTANBgkqhkiG9w0BAQwFADBh
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD
QTAeFw0yMTA0MTQwMDAwMDBaFw0zMTA0MTMyMzU5NTlaMFYxCzAJBgNVBAYTAlVT
MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxMDAuBgNVBAMTJ0RpZ2lDZXJ0IFRMUyBI
eWJyaWQgRUNDIFNIQTM4NCAyMDIwIENBMTB2MBAGByqGSM49AgEGBSuBBAAiA2IA
BMEbxppbmNmkKaDp1AS12+umsmxVwP/tmMZJLwYnUcu/cMEFesOxnYeJuq20ExfJ
qLSDyLiQ0cx0NTY8g3KwtdD3ImnI8YDEe0CPz2iHJlw5ifFNkU3aiYvkA8ND5b8v
c6OCAYIwggF+MBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFAq8CCkXjKU5
bXoOzjPHLrPt+8N6MB8GA1UdIwQYMBaAFAPeUDVW0Uy7ZvCj4hsbw5eyPdFVMA4G
A1UdDwEB/wQEAwIBhjAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwdgYI
KwYBBQUHAQEEajBoMCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5kaWdpY2VydC5j
b20wQAYIKwYBBQUHMAKGNGh0dHA6Ly9jYWNlcnRzLmRpZ2ljZXJ0LmNvbS9EaWdp
Q2VydEdsb2JhbFJvb3RDQS5jcnQwQgYDVR0fBDswOTA3oDWgM4YxaHR0cDovL2Ny
bDMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0R2xvYmFsUm9vdENBLmNybDA9BgNVHSAE
NjA0MAsGCWCGSAGG/WwCATAHBgVngQwBATAIBgZngQwBAgEwCAYGZ4EMAQICMAgG
BmeBDAECAzANBgkqhkiG9w0BAQwFAAOCAQEAR1mBf9QbH7Bx9phdGLqYR5iwfnYr
6v8ai6wms0KNMeZK6BnQ79oU59cUkqGS8qcuLa/7Hfb7U7CKP/zYFgrpsC62pQsY
kDUmotr2qLcy/JUjS8ZFucTP5Hzu5sn4kL1y45nDHQsFfGqXbbKrAjbYwrwsAZI/
BKOLdRHHuSm8EdCGupK8JvllyDfNJvaGEwwEqonleLHBTnm8dqMLUeTF0J5q/hos
Vq4GNiejcxwIfZMy0MJEGdqN9A57HSgDKwmKdsp33Id6rHtSJlWncg+d0ohP/rEh
xRqhqjn1VtvChMQ1H3Dau0bwhr9kAMQ+959GG50jBbl9s08PqUU643QwmA==
-----END CERTIFICATE-----
")) :certificate (:version 3 :serial-number "0b:89:05:37:12:5f:45:10:d6:37:2a:10:28:a9:29:a5" :issuer "C=US,O=DigiCert Inc,CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1" :valid-from "2023-02-16" :valid-to "2024-03-15" :subject "C=US,ST=California,L=San Francisco,O=GitHub\\, Inc.,CN=*.github.com" :public-key-algorithm "EC/ECDSA" :certificate-security-level "High" :signature-algorithm "ECDSA-SHA384" :public-key-id "sha1:b6:3f:03:4b:19:b5:09:31:ad:35:c2:7b:0c:10:5b:e3:49:f4:14:3b" :certificate-id "sha1:2d:79:6c:90:2d:ad:8a:2e:4f:d1:e2:99:ed:e8:91:29:36:40:f8:58" :pem "-----BEGIN CERTIFICATE-----
MIIFaTCCBO+gAwIBAgIQC4kFNxJfRRDWNyoQKKkppTAKBggqhkjOPQQDAzBWMQsw
CQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMTAwLgYDVQQDEydEaWdp
Q2VydCBUTFMgSHlicmlkIEVDQyBTSEEzODQgMjAyMCBDQTEwHhcNMjMwMjE2MDAw
MDAwWhcNMjQwMzE1MjM1OTU5WjBoMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2Fs
aWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZyYW5jaXNjbzEVMBMGA1UEChMMR2l0SHVi
LCBJbmMuMRUwEwYDVQQDDAwqLmdpdGh1Yi5jb20wWTATBgcqhkjOPQIBBggqhkjO
PQMBBwNCAARUH0Nrue1CP3dESL1ihStO87/CuTPEuV5esOMkZ7U4je2yuT5xZtlg
BvAvq6duFmwCpvIFyvkEcrkze/FlVIZGo4IDizCCA4cwHwYDVR0jBBgwFoAUCrwI
KReMpTlteg7OM8cus+37w3owHQYDVR0OBBYEFDwu28aLLUMbaoExfeOXEcn3+OsI
MCMGA1UdEQQcMBqCDCouZ2l0aHViLmNvbYIKZ2l0aHViLmNvbTAOBgNVHQ8BAf8E
BAMCB4AwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMIGbBgNVHR8EgZMw
gZAwRqBEoEKGQGh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5
YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5jcmwwRqBEoEKGQGh0dHA6Ly9jcmw0LmRp
Z2ljZXJ0LmNvbS9EaWdpQ2VydFRMU0h5YnJpZEVDQ1NIQTM4NDIwMjBDQTEtMS5j
cmwwPgYDVR0gBDcwNTAzBgZngQwBAgIwKTAnBggrBgEFBQcCARYbaHR0cDovL3d3
dy5kaWdpY2VydC5jb20vQ1BTMIGFBggrBgEFBQcBAQR5MHcwJAYIKwYBBQUHMAGG
GGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBPBggrBgEFBQcwAoZDaHR0cDovL2Nh
Y2VydHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0VExTSHlicmlkRUNDU0hBMzg0MjAy
MENBMS0xLmNydDAJBgNVHRMEAjAAMIIBfgYKKwYBBAHWeQIEAgSCAW4EggFqAWgA
dgDuzdBk1dsazsVct520zROiModGfLzs3sNRSFlGcR+1mwAAAYZbCs3zAAAEAwBH
MEUCIArGXZDo62J6BVdPjIPk+H7q9+UoVANmnCejGAGKR1XRAiEAm7ggdSeB2Mu8
XgzTT4mTL/KR3WHXHkqdbPXt8nXYWyMAdgBz2Z6JG0yWeKAgfUed5rLGHNBRXnEZ
KoxrgBB6wXdytQAAAYZbCs5IAAAEAwBHMEUCIGxWpr58dem8sgHumQBm+cysaKAn
xb9/5uOr29yhALEgAiEAz6/uoCrCHtiOEjToUUyQUoWvIS2yxCRuJ5a229RZ468A
dgBIsONr2qZHNA/lagL6nTDrHFIBy1bdLIHZu7+rOdiEcwAAAYZbCs4BAAAEAwBH
MEUCIQCKTfSwHfwxDHXZXeglt7MuunJiK1Z5ZqlbKbrNxsGjawIgM/JYG7f3HFlB
DO9XyrPKcZs5zUCuWfeej5FbKjgmTnQwCgYIKoZIzj0EAwMDaAAwZQIwMUgizPft
BREzRzfvZU26bzV3khG+tLUSl5vETtKiZvO9DFRkrfgE5OwJqqe6XdXXAjEA+3jK
aW4/QLTPHGYSiBZZswDEGpwwpn0khV/v2JdSjqqcO0bRiy2O6grh9+/JzgXr
-----END CERTIFICATE-----
") :key-exchange "ECDHE-RSA" :protocol "TLS1.3" :cipher "AES-128-GCM" :mac "AEAD" :encrypt-then-mac nil)) #s(ghub--req #s(url "https" nil nil "api.github.com" nil "/repos/cambioscience/obrizum/pulls/320/reviews" nil nil t nil t t) nil nil "POST" (closure ((forge) (username . "chrishowejones") (auth . code-review) (host . "api.github.com") (headers ("Content-Type" . "application/json")) cl-struct-ghub--req-tags url-http-response-status url-http-extra-headers url-http-end-of-headers url-callback-arguments t) nil (if (eq auth 'basic) (cons (cons "Authorization" (ghub--basic-auth host username)) headers) (cons (ghub--auth host auth username forge) headers))) ghub--handle-response nil t nil (closure ((local-comments) (replies) (replies-obj . #s(code-review-submit-github-replies #s(#s(eieio--class code-review-github-repo nil (#s(eieio--class code-review-db-pullreq nil (#s(eieio--class closql-object nil nil [#s(cl-slot-descriptor closql-database nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1)) (forge-object code-review-db-pullreq code-review-db-comment code-review-db-path code-review-db-buffer) ((:closql-database . closql-database)) [#s(cl-slot-descriptor closql-order-by nil t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key nil t nil) #s(cl-slot-descriptor closql-table nil t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix nil t nil)] [nil nil nil nil nil nil] #s(#11 nil) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer)))] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30)) (code-review-bitbucket-repo code-review-gitlab-repo code-review-github-repo) ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-class-prefix "code-review-" t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-order-by [(desc number)] t nil)] ["code-review-" nil pullreq id nil [(desc number)]] #s(#9 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer))) #s(cl-slot-descriptor callback nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30 callback 31)) nil ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-order-by [(desc number)] t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix "code-review-" t nil)] [[(desc number)] nil id pullreq nil "code-review-"] #s(#7 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound nil) (:custom-groups nil)) #s(code-review-db-database #<process emacsql-sqlite<1>> #<buffer  *emacsql-log*-621227> #<finalizer> "/home/chris/.emacs.d/code-review-db-file.sqlite") "e52b6418-8937-4eea-8bd1-1b67e7a3c4d4" "master" "OBR-1050-Registrations-in-Metabase-Persons-table" nil nil nil nil ((id . "PR_kwDOFQcPnc5NjyMK") (author (login . "dattan010280") (url . "https://github.com/dattan010280")) (headRefOid . "f879b9ec3abbba7388ead04d317214bf3d8cec81") (baseRefName . "master") (headRefName . "OBR-1050-Registrations-in-Metabase-Persons-table") (isDraft) (databaseId . 1301226250) (number . 320) (createdAt . "2023-04-04T07:58:54Z") (updatedAt . "2023-04-06T02:14:54Z") (latestOpinionatedReviews (nodes ((author (login . "chenlilyd") (url . "https://github.com/chenlilyd")) (createdAt . "2023-04-05T10:45:02Z") (state . "APPROVED")) ((author (login . "aibrahim") (url . "https://github.com/aibrahim")) (createdAt . "2023-04-05T08:09:31Z") (state . "APPROVED")))) (reviewRequests (nodes)) (files (nodes ((path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (additions . 9) (deletions . 0)) ((path . "bases/space-invader/src/main/app/model/user_metric.clj") (additions . 1) (deletions . 1)))) (milestone) (labels (nodes)) (assignees (nodes)) (projectCards (nodes)) (suggestedReviewers) (commits (totalCount . 2) (nodes ((commit (abbreviatedOid . "b9cf554") (message . "OBR-1050-Registrations-in-Metabase-Persons-table") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T08:03:27Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137312971") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T07:59:45Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313144") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:02Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313296") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:08Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313467") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))) ((commit (abbreviatedOid . "f879b9e") (message . "OBR-1050-Update on Abdullah's comment") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-06T02:14:33Z") (completedAt . "2023-04-06T02:19:08Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179857874") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858003") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858127") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:32Z") (completedAt . "2023-04-06T02:15:19Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858243") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))))) (title . "[OBR-1050] Registrations-in-Metabase-Persons-table") (state . "OPEN") (bodyHTML . "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>") (bodyText . "Hello Team,
Please help to review this for OBR-1050. Thanks.

Add store-new-users-to-metrics for new Gas Safe Invitations") (reactions (nodes)) (comments (nodes)) (reviews (nodes ((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))))) "diff --git bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
index dd54e630..19d1e4bc 100644
--- bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
+++ bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
@@ -1,5 +1,6 @@
 (ns app.model.user-membership.gas-safe-invitations
   (:require
+   [app.model.user-metric :as user-metric]
    [app.server-components.client :as client]
    [app.utils :as utils]
    [buddy.sign.jwt :as jwt]
@@ -211,6 +212,13 @@
     ctx
     (flow/fail-with {:msg \"No users to invite\"})))
 
+(defn save-registration-metrics!
+  [{:keys [users db conn] :as params}]
+  (->> users
+       (mapv :person/uuid)
+       (user-metric/store-new-users-to-metrics conn db)
+       (merge params)))
+
 (defmutation start-invitations
   [{:keys [conn db]} {:keys [csv-users description]}]
   {::pc/params [:csv-users]
@@ -225,6 +233,7 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call save-registration-metrics!)
     (flow/then-call create-invitation-session)
     (flow/then start-session)
     (flow/then (fn [{:keys [invitation]}]
diff --git bases/space-invader/src/main/app/model/user_metric.clj bases/space-invader/src/main/app/model/user_metric.clj
index e4dd94a1..d5111a24 100644
--- bases/space-invader/src/main/app/model/user_metric.clj
+++ bases/space-invader/src/main/app/model/user_metric.clj
@@ -24,7 +24,7 @@
           _ (log/info \"Transact user-metric [person-account-registered] into Datomic\")
           {:keys [db-after]} (d/transact conn {:tx-data tx-data})]
       (if db-after
-        {:user-metric/saved? true}
+        {:user-metric/saved? true :db db-after}
         (throw (ex-info (str \"Invited users metric transaction failed\")
                         {:user-metric/saved? false}))))
     (catch Exception e" (((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))) "cambioscience" "obrizum" "320" "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>" "[OBR-1050] Registrations-in-Metabase-Persons-table" nil "f879b9ec3abbba7388ead04d317214bf3d8cec81" nil "OPEN" nil nil nil nil ((title) (perc) (number)) nil nil nil nil eieio--unbound nil) nil)) (review-obj . #s(code-review-submit-github-review "COMMENT" #s(#s(eieio--class code-review-github-repo nil (#s(eieio--class code-review-db-pullreq nil (#s(eieio--class closql-object nil nil [#s(cl-slot-descriptor closql-database nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1)) (forge-object code-review-db-pullreq code-review-db-comment code-review-db-path code-review-db-buffer) ((:closql-database . closql-database)) [#s(cl-slot-descriptor closql-order-by nil t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key nil t nil) #s(cl-slot-descriptor closql-table nil t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix nil t nil)] [nil nil nil nil nil nil] #s(#11 nil) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer)))] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30)) (code-review-bitbucket-repo code-review-gitlab-repo code-review-github-repo) ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-class-prefix "code-review-" t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-order-by [(desc number)] t nil)] ["code-review-" nil pullreq id nil [(desc number)]] #s(#9 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer))) #s(cl-slot-descriptor callback nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30 callback 31)) nil ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-order-by [(desc number)] t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix "code-review-" t nil)] [[(desc number)] nil id pullreq nil "code-review-"] #s(#7 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound nil) (:custom-groups nil)) #s(code-review-db-database #<process emacsql-sqlite<1>> #<buffer  *emacsql-log*-621227> #<finalizer> "/home/chris/.emacs.d/code-review-db-file.sqlite") "e52b6418-8937-4eea-8bd1-1b67e7a3c4d4" "master" "OBR-1050-Registrations-in-Metabase-Persons-table" nil nil nil nil ((id . "PR_kwDOFQcPnc5NjyMK") (author (login . "dattan010280") (url . "https://github.com/dattan010280")) (headRefOid . "f879b9ec3abbba7388ead04d317214bf3d8cec81") (baseRefName . "master") (headRefName . "OBR-1050-Registrations-in-Metabase-Persons-table") (isDraft) (databaseId . 1301226250) (number . 320) (createdAt . "2023-04-04T07:58:54Z") (updatedAt . "2023-04-06T02:14:54Z") (latestOpinionatedReviews (nodes ((author (login . "chenlilyd") (url . "https://github.com/chenlilyd")) (createdAt . "2023-04-05T10:45:02Z") (state . "APPROVED")) ((author (login . "aibrahim") (url . "https://github.com/aibrahim")) (createdAt . "2023-04-05T08:09:31Z") (state . "APPROVED")))) (reviewRequests (nodes)) (files (nodes ((path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (additions . 9) (deletions . 0)) ((path . "bases/space-invader/src/main/app/model/user_metric.clj") (additions . 1) (deletions . 1)))) (milestone) (labels (nodes)) (assignees (nodes)) (projectCards (nodes)) (suggestedReviewers) (commits (totalCount . 2) (nodes ((commit (abbreviatedOid . "b9cf554") (message . "OBR-1050-Registrations-in-Metabase-Persons-table") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T08:03:27Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137312971") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T07:59:45Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313144") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:02Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313296") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:08Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313467") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))) ((commit (abbreviatedOid . "f879b9e") (message . "OBR-1050-Update on Abdullah's comment") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-06T02:14:33Z") (completedAt . "2023-04-06T02:19:08Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179857874") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858003") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858127") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:32Z") (completedAt . "2023-04-06T02:15:19Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858243") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))))) (title . "[OBR-1050] Registrations-in-Metabase-Persons-table") (state . "OPEN") (bodyHTML . "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>") (bodyText . "Hello Team,
Please help to review this for OBR-1050. Thanks.

Add store-new-users-to-metrics for new Gas Safe Invitations") (reactions (nodes)) (comments (nodes)) (reviews (nodes ((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))))) "diff --git bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
index dd54e630..19d1e4bc 100644
--- bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
+++ bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
@@ -1,5 +1,6 @@
 (ns app.model.user-membership.gas-safe-invitations
   (:require
+   [app.model.user-metric :as user-metric]
    [app.server-components.client :as client]
    [app.utils :as utils]
    [buddy.sign.jwt :as jwt]
@@ -211,6 +212,13 @@
     ctx
     (flow/fail-with {:msg \"No users to invite\"})))
 
+(defn save-registration-metrics!
+  [{:keys [users db conn] :as params}]
+  (->> users
+       (mapv :person/uuid)
+       (user-metric/store-new-users-to-metrics conn db)
+       (merge params)))
+
 (defmutation start-invitations
   [{:keys [conn db]} {:keys [csv-users description]}]
   {::pc/params [:csv-users]
@@ -225,6 +233,7 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call save-registration-metrics!)
     (flow/then-call create-invitation-session)
     (flow/then start-session)
     (flow/then (fn [{:keys [invitation]}]
diff --git bases/space-invader/src/main/app/model/user_metric.clj bases/space-invader/src/main/app/model/user_metric.clj
index e4dd94a1..d5111a24 100644
--- bases/space-invader/src/main/app/model/user_metric.clj
+++ bases/space-invader/src/main/app/model/user_metric.clj
@@ -24,7 +24,7 @@
           _ (log/info \"Transact user-metric [person-account-registered] into Datomic\")
           {:keys [db-after]} (d/transact conn {:tx-data tx-data})]
       (if db-after
-        {:user-metric/saved? true}
+        {:user-metric/saved? true :db db-after}
         (throw (ex-info (str \"Invited users metric transaction failed\")
                         {:user-metric/saved? false}))))
     (catch Exception e" (((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))) "cambioscience" "obrizum" "320" "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>" "[OBR-1050] Registrations-in-Metabase-Persons-table" nil "f879b9ec3abbba7388ead04d317214bf3d8cec81" nil "OPEN" nil nil nil nil ((title) (perc) (number)) nil nil nil nil eieio--unbound nil) nil nil)) (pr . #s(#s(eieio--class code-review-github-repo nil (#s(eieio--class code-review-db-pullreq nil (#s(eieio--class closql-object nil nil [#s(cl-slot-descriptor closql-database nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1)) (forge-object code-review-db-pullreq code-review-db-comment code-review-db-path code-review-db-buffer) ((:closql-database . closql-database)) [#s(cl-slot-descriptor closql-order-by nil t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key nil t nil) #s(cl-slot-descriptor closql-table nil t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix nil t nil)] [nil nil nil nil nil nil] #s(#10 nil) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer)))] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30)) (code-review-bitbucket-repo code-review-gitlab-repo code-review-github-repo) ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-class-prefix "code-review-" t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-order-by [(desc number)] t nil)] ["code-review-" nil pullreq id nil [(desc number)]] #s(#8 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound) (:custom-groups nil :abstract t))) [#s(cl-slot-descriptor closql-database nil t nil) #s(cl-slot-descriptor id 'eieio--unbound t nil) #s(cl-slot-descriptor base-ref-name nil t nil) #s(cl-slot-descriptor head-ref-name nil t nil) #s(cl-slot-descriptor finished nil t nil) #s(cl-slot-descriptor finished-at nil t nil) #s(cl-slot-descriptor saved nil t nil) #s(cl-slot-descriptor saved-at nil t nil) #s(cl-slot-descriptor raw-infos nil t nil) #s(cl-slot-descriptor raw-diff nil t nil) #s(cl-slot-descriptor raw-comments nil t nil) #s(cl-slot-descriptor owner 'eieio--unbound t nil) #s(cl-slot-descriptor repo 'eieio--unbound t nil) #s(cl-slot-descriptor number 'eieio--unbound t nil) #s(cl-slot-descriptor description nil t nil) #s(cl-slot-descriptor title nil t nil) #s(cl-slot-descriptor host nil t nil) #s(cl-slot-descriptor sha nil t nil) #s(cl-slot-descriptor feedback nil t nil) #s(cl-slot-descriptor state nil t nil) #s(cl-slot-descriptor replies nil t nil) #s(cl-slot-descriptor review nil t nil) #s(cl-slot-descriptor labels nil t nil) #s(cl-slot-descriptor merge nil t nil) #s(cl-slot-descriptor milestones nil t nil) #s(cl-slot-descriptor projects nil t nil) #s(cl-slot-descriptor reviewers nil t nil) #s(cl-slot-descriptor assignees nil t nil) #s(cl-slot-descriptor linked-issues nil t nil) #s(cl-slot-descriptor buffer 'eieio--unbound t ((:closql-class . code-review-db-buffer))) #s(cl-slot-descriptor callback nil t nil)] #s(hash-table size 65 test eq rehash-size 1.5 rehash-threshold 0.8125 data (closql-database 1 id 2 base-ref-name 3 head-ref-name 4 finished 5 finished-at 6 saved 7 saved-at 8 raw-infos 9 raw-diff 10 raw-comments 11 owner 12 repo 13 number 14 description 15 title 16 host 17 sha 18 feedback 19 state 20 replies 21 review 22 labels 23 merge 24 milestones 25 projects 26 reviewers 27 assignees 28 linked-issues 29 buffer 30 callback 31)) nil ((:closql-database . closql-database) (:id . id) (:owner . owner) (:repo . repo) (:number . number)) [#s(cl-slot-descriptor closql-order-by [(desc number)] t nil) #s(cl-slot-descriptor closql-foreign-key nil t nil) #s(cl-slot-descriptor closql-primary-key 'id t nil) #s(cl-slot-descriptor closql-table 'pullreq t nil) #s(cl-slot-descriptor closql-class-suffix nil t nil) #s(cl-slot-descriptor closql-class-prefix "code-review-" t nil)] [[(desc number)] nil id pullreq nil "code-review-"] #s(#6 nil eieio--unbound nil nil nil nil nil nil nil nil nil eieio--unbound eieio--unbound eieio--unbound nil nil nil nil nil nil nil nil nil nil nil nil nil nil nil eieio--unbound nil) (:custom-groups nil)) #s(code-review-db-database #<process emacsql-sqlite<1>> #<buffer  *emacsql-log*-621227> #<finalizer> "/home/chris/.emacs.d/code-review-db-file.sqlite") "e52b6418-8937-4eea-8bd1-1b67e7a3c4d4" "master" "OBR-1050-Registrations-in-Metabase-Persons-table" nil nil nil nil ((id . "PR_kwDOFQcPnc5NjyMK") (author (login . "dattan010280") (url . "https://github.com/dattan010280")) (headRefOid . "f879b9ec3abbba7388ead04d317214bf3d8cec81") (baseRefName . "master") (headRefName . "OBR-1050-Registrations-in-Metabase-Persons-table") (isDraft) (databaseId . 1301226250) (number . 320) (createdAt . "2023-04-04T07:58:54Z") (updatedAt . "2023-04-06T02:14:54Z") (latestOpinionatedReviews (nodes ((author (login . "chenlilyd") (url . "https://github.com/chenlilyd")) (createdAt . "2023-04-05T10:45:02Z") (state . "APPROVED")) ((author (login . "aibrahim") (url . "https://github.com/aibrahim")) (createdAt . "2023-04-05T08:09:31Z") (state . "APPROVED")))) (reviewRequests (nodes)) (files (nodes ((path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (additions . 9) (deletions . 0)) ((path . "bases/space-invader/src/main/app/model/user_metric.clj") (additions . 1) (deletions . 1)))) (milestone) (labels (nodes)) (assignees (nodes)) (projectCards (nodes)) (suggestedReviewers) (commits (totalCount . 2) (nodes ((commit (abbreviatedOid . "b9cf554") (message . "OBR-1050-Registrations-in-Metabase-Persons-table") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T08:03:27Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137312971") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:07Z") (completedAt . "2023-04-04T07:59:45Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313144") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:02Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313296") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-04T07:59:08Z") (completedAt . "2023-04-04T08:00:08Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4605366391/jobs/8137313467") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))) ((commit (abbreviatedOid . "f879b9e") (message . "OBR-1050-Update on Abdullah's comment") (statusCheckRollup (state . "SUCCESS") (contexts (nodes ((startedAt . "2023-04-06T02:14:33Z") (completedAt . "2023-04-06T02:19:08Z") (name . "test (space-invader)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179857874") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (obrio)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858003") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:34Z") (completedAt . "2023-04-06T02:15:12Z") (name . "test (customer-api)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858127") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test"))))) ((startedAt . "2023-04-06T02:14:32Z") (completedAt . "2023-04-06T02:15:19Z") (name . "test (redshift)") (text) (title) (summary) (status . "COMPLETED") (conclusion . "SUCCESS") (detailsUrl . "https://github.com/cambioscience/obrizum/actions/runs/4624742959/jobs/8179858243") (checkSuite (app (id . "MDM6QXBwMTUzNjg=") (name . "GitHub Actions") (description . "Automate your workflow from idea to production") (slug . "github-actions") (logoUrl . "https://avatars.githubusercontent.com/in/15368?u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4")) (workflowRun (workflow (name . "Test")))))))))))) (title . "[OBR-1050] Registrations-in-Metabase-Persons-table") (state . "OPEN") (bodyHTML . "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>") (bodyText . "Hello Team,
Please help to review this for OBR-1050. Thanks.

Add store-new-users-to-metrics for new Gas Safe Invitations") (reactions (nodes)) (comments (nodes)) (reviews (nodes ((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))))) "diff --git bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
index dd54e630..19d1e4bc 100644
--- bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
+++ bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj
@@ -1,5 +1,6 @@
 (ns app.model.user-membership.gas-safe-invitations
   (:require
+   [app.model.user-metric :as user-metric]
    [app.server-components.client :as client]
    [app.utils :as utils]
    [buddy.sign.jwt :as jwt]
@@ -211,6 +212,13 @@
     ctx
     (flow/fail-with {:msg \"No users to invite\"})))
 
+(defn save-registration-metrics!
+  [{:keys [users db conn] :as params}]
+  (->> users
+       (mapv :person/uuid)
+       (user-metric/store-new-users-to-metrics conn db)
+       (merge params)))
+
 (defmutation start-invitations
   [{:keys [conn db]} {:keys [csv-users description]}]
   {::pc/params [:csv-users]
@@ -225,6 +233,7 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call save-registration-metrics!)
     (flow/then-call create-invitation-session)
     (flow/then start-session)
     (flow/then (fn [{:keys [invitation]}]
diff --git bases/space-invader/src/main/app/model/user_metric.clj bases/space-invader/src/main/app/model/user_metric.clj
index e4dd94a1..d5111a24 100644
--- bases/space-invader/src/main/app/model/user_metric.clj
+++ bases/space-invader/src/main/app/model/user_metric.clj
@@ -24,7 +24,7 @@
           _ (log/info \"Transact user-metric [person-account-registered] into Datomic\")
           {:keys [db-after]} (d/transact conn {:tx-data tx-data})]
       (if db-after
-        {:user-metric/saved? true}
+        {:user-metric/saved? true :db db-after}
         (throw (ex-info (str \"Invited users metric transaction failed\")
                         {:user-metric/saved? false}))))
     (catch Exception e" (((typename . "PullRequestReview") (author (login . "aibrahim")) (bodyHTML . "<p dir=\"auto\">non-blocking comments</p>") (state . "APPROVED") (createdAt . "2023-04-05T08:09:31Z") (databaseId . 1372374885) (updatedAt . "2023-04-05T08:10:57Z") (comments (nodes ((createdAt . "2023-04-05T08:09:31Z") (updatedAt . "2023-04-05T08:10:57Z") (bodyHTML . "<p dir=\"auto\">hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dattan010280/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dattan010280\">@dattan010280</a>,<br>
if you can extract that function to a private function or so...</p>
<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"save-registeration-metrics!\"><pre class=\"notranslate\"><code class=\"notranslate\">save-registeration-metrics!
</code></pre></div>
<p dir=\"auto\">or something similiar, you can decide better name.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158170996) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-05T10:44:18Z") (databaseId . 1372643284) (updatedAt . "2023-04-05T10:44:18Z") (comments (nodes ((createdAt . "2023-04-05T10:44:18Z") (updatedAt . "2023-04-05T10:44:18Z") (bodyHTML . "<p dir=\"auto\">Metrics is saved before sending invitation emails, this is different from normal invitation. Is this expected?</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1158344600) (reactions (nodes)))))) ((typename . "PullRequestReview") (author (login . "chenlilyd")) (bodyHTML . "<p dir=\"auto\">lgtm</p>") (state . "APPROVED") (createdAt . "2023-04-05T10:45:02Z") (databaseId . 1372644455) (updatedAt . "2023-04-05T10:45:02Z") (comments (nodes))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T01:58:41Z") (databaseId . 1373952265) (updatedAt . "2023-04-06T01:58:42Z") (comments (nodes ((createdAt . "2023-04-06T01:58:41Z") (updatedAt . "2023-04-06T01:58:42Z") (bodyHTML . "<p dir=\"auto\">Hello <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chenlilyd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chenlilyd\">@chenlilyd</a>, I think so because users are already created in previous step. Thanks Chen.</p>") (originalPosition . 14) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159211311) (reactions (nodes ((id . "REA_lATOFQcPnc5FGCkvzgv8dA0") (content . "THUMBS_UP")))))))) ((typename . "PullRequestReview") (author (login . "dattan010280")) (bodyHTML . "") (state . "COMMENTED") (createdAt . "2023-04-06T02:14:54Z") (databaseId . 1373961187) (updatedAt . "2023-04-06T02:14:54Z") (comments (nodes ((createdAt . "2023-04-06T02:14:54Z") (updatedAt . "2023-04-06T02:14:54Z") (bodyHTML . "<p dir=\"auto\">Thanks <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/aibrahim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/aibrahim\">@aibrahim</a>. I have updated.</p>") (originalPosition . 15) (diffHunk . "@@ -225,6 +226,11 @@
     (flow/then-call remove-existing-users)
     (flow/then ensure-users)
     (flow/then-call create-users)
+    (flow/then-call (fn [{:keys [users db conn] :as params}]
+                      (->> users
+                           (mapv :person/uuid)
+                           (user-metric/store-new-users-to-metrics conn db)
+                           (merge params))))") (position) (outdated . t) (path . "bases/space-invader/src/main/app/model/user_membership/gas_safe_invitations.clj") (databaseId . 1159217614) (reactions (nodes))))))) "cambioscience" "obrizum" "320" "<p dir=\"auto\">Hello Team,<br>
Please help to review this for <a href=\"https://obrizum.atlassian.net/browse/OBR-1050\" rel=\"nofollow\">OBR-1050</a>. Thanks.</p>
<ul dir=\"auto\">
<li>Add <code class=\"notranslate\">store-new-users-to-metrics</code> for new Gas Safe Invitations</li>
</ul>" "[OBR-1050] Registrations-in-Metabase-Persons-table" nil "f879b9ec3abbba7388ead04d317214bf3d8cec81" nil "OPEN" nil nil nil nil ((title) (perc) (number)) nil nil nil nil eieio--unbound nil)) (only-reply?) (feedback) (event . "COMMENT") t) (&rest _) (let ((code-review-section-full-refresh? t)) (eieio-oset pr 'finished t) (eieio-oset pr 'finished-at (current-time-string)) (code-review-db-update pr) (code-review--build-buffer code-review-buffer-name nil "Done submitting review"))) code-review-github-errback nil nil))
